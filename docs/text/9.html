<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ტექსტი — სიტყუა ართრონთათჳს</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'parchment': '#faf8f5',
                        'ink': '#1a1a1a',
                        'manuscript': '#f5f2ed',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@300;400;500;600&family=Noto+Serif+Georgian:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Georgian', sans-serif; }
        .font-serif-geo { font-family: 'Noto Serif Georgian', Georgia, serif; }
        .greek { font-family: 'Times New Roman', serif; font-style: italic; }
.term-link { 
    text-decoration: underline; 
    text-decoration-color: #a5b4fc; 
    text-decoration-thickness: 2px;
    text-underline-offset: 2px;
    cursor: pointer;
}
.term-link:hover { 
    text-decoration-color: #6366f1;
    background: #eef2ff;
    border-radius: 2px;
}
.folio-marker { 
    font-size: 0.7em; 
    color: #888;
    font-family: 'Noto Sans Georgian', sans-serif;
}
.apparatus-marker { 
    color: #b45309; 
    font-size: 0.5em; 
    margin-left: -5px; 
    cursor: pointer;
    vertical-align: super;
    font-weight: 500;
}
.apparatus-marker:hover { color: #92400e; }
.apparatus-inline {
    border-bottom: 1px dotted #d97706;
}
.reading-s {
    background: #fef3c7;
    padding: 0 2px;
    border-radius: 2px;
}
.witness-toggle.active { 
    background: #1a1a1a; 
    color: white; 
}
.section-anchor {
    color: #9ca3af;
    opacity: 0;
    transition: opacity 0.15s;
    margin-left: 0.5rem;
}
section:hover .section-anchor {
    opacity: 1;
}
.apparatus-entry.highlighted {
    background: #fef9c3;
    margin: -0.25rem -0.5rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
}
.section-divider {
    border-top: 1px solid #e5e7eb;
    margin: 2rem 0;
    position: relative;
}
.section-divider::before {
    content: '§';
    position: absolute;
    top: -0.75rem;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 0 0.5rem;
    color: #d1d5db;
    font-size: 0.875rem;
}
.witness-bar {
    transition: all 0.2s ease;
}

/* Lexicon Popup - Margin note style */
.lexicon-popup {
    position: absolute;
    z-index: 50;
    width: 260px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.15s, visibility 0.15s;
}
.lexicon-popup.visible {
    opacity: 1;
    visibility: visible;
}

/* Connector line to term (large screens) */
.lexicon-popup::before {
    content: '';
    position: absolute;
    top: 14px;
    left: -20px;
    width: 20px;
    height: 1px;
    background: #d1d5db;
}
.lexicon-popup::after {
    content: '';
    position: absolute;
    top: 11px;
    left: -6px;
    width: 6px;
    height: 6px;
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
}

/* Small screens - popup below term */
@media (max-width: 1280px) {
    .lexicon-popup::before,
    .lexicon-popup::after {
        display: none;
    }
}
    </style>
</head>
<body class="bg-parchment text-ink antialiased">
    
    <!-- Navigation -->
    <nav class="border-b border-gray-200 sticky top-0 bg-parchment/95 backdrop-blur-sm z-10">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-14">
                <a href="../index.html" class="text-lg font-medium text-gray-800">
                    სიტყუა ართრონთათჳს
                </a>
                <div class="flex items-center gap-6">
                    <a href="../text/index.html" class="text-sm text-ink border-b border-gray-400 pb-0.5">ტექსტი</a>
                    <a href="../lexicon/index.html" class="text-sm text-gray-600 hover:text-ink">ლექსიკონი</a>
                    <a href="../sadziebeli.html" class="text-sm text-gray-600 hover:text-ink">საძიებელი</a>
                    <a href="../about.html" class="text-sm text-gray-600 hover:text-ink">შესახებ</a>
                </div>
            </div>
        </div>
    </nav>

<main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-4">
            <h1 class="text-xl font-medium">ტრაქტატის ტექსტი</h1>
            <span class="text-sm text-gray-400">24 პარაგრაფი</span>
        </div>
        <div class="flex items-center gap-3 text-sm">
            <span class="text-gray-400">ხელნაწერი:</span>
            <button id="wit-a" class="witness-toggle active px-3 py-1 rounded text-xs border border-gray-300" data-witness="A" title="ხელნაწერი A (თბილისი)">A</button>
            <button id="wit-s" class="witness-toggle px-3 py-1 bg-white border border-gray-300 text-gray-600 rounded text-xs hover:bg-gray-50" data-witness="S" title="ხელნაწერი S (სინა)">S</button>
        </div>
    </div>
    
    <!-- Witness Info Bar -->
    <div class="witness-bar bg-gray-50 border border-gray-200 rounded-lg px-4 py-2.5 mb-6 flex items-center justify-between text-sm">
        <div class="flex items-center gap-2">
            <span class="inline-flex items-center justify-center w-6 h-6 rounded bg-gray-800 text-white text-xs font-medium" id="witness-sigil">A</span>
            <div class="text-gray-600">
                <span id="witness-settlement">ათონი</span><span class="text-gray-300 mx-1.5">·</span><span id="witness-repository" class="text-gray-500">ივერიის (ივერთა) მონასტერი</span><span class="text-gray-300 mx-1.5">·</span><span id="witness-locus" class="text-gray-400">ff. 32r–36v</span>
            </div>
        </div>
        <a href="../manuscripts/index.html" class="text-xs text-gray-400 hover:text-gray-600 flex items-center gap-1">
            ხელნაწერების შესახებ
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </a>
    </div>

    <!-- Text Container -->
    <article id="text-article" class="bg-white rounded-lg border border-gray-200 relative">
        
        <!-- Navigation bar -->
        <div class="border-b border-gray-100 px-6 py-3 flex items-center justify-between">
            <!-- Left: Section navigation -->
            <div class="flex items-center gap-3">
                <a href="../text/8.html" 
                   class="text-gray-400 hover:text-gray-600"
                   title="წინა პარაგრაფი">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>
                <select id="section-select" class="text-sm text-gray-600 border-0 bg-transparent focus:ring-0 cursor-pointer" onchange="window.location.href=this.value">
                    <option value="../text/1.html" >
                        § 1. შეისწავე, რამეთუ ვინაითგა...
                    </option>
                    <option value="../text/2.html" >
                        § 2. ხოლო საჭირო არს პირველად ...
                    </option>
                    <option value="../text/3.html" >
                        § 3.      არიან  ; ათცამეტნი ვ...
                    </option>
                    <option value="../text/4.html" >
                        § 4. რამეთუ   ვიდრემე სახელი  ...
                    </option>
                    <option value="../text/5.html" >
                        § 5.  ხუთნი არიან და  ; გარნა ...
                    </option>
                    <option value="../text/6.html" >
                        § 6. ვინაჲ პირველსავე სიტყუასა...
                    </option>
                    <option value="../text/7.html" >
                        § 7. ხოლო   რაჲ   საზღვართაებრ...
                    </option>
                    <option value="../text/8.html" >
                        § 8. ხოლო   ვითარღა ცხად-ვყოთ,...
                    </option>
                    <option value="../text/9.html" selected>
                        § 9. ხოლო   რაჲ     ღმერთთასა,...
                    </option>
                    <option value="../text/10.html" >
                        § 10. რამეთუ ბერძულად   აქუს   ...
                    </option>
                    <option value="../text/11.html" >
                        § 11.    ორი ძალი აქუს   და ერთ...
                    </option>
                    <option value="../text/12.html" >
                        § 12.    სახელისა   თავით კერძო...
                    </option>
                    <option value="../text/13.html" >
                        § 13. რამეთუ   სახელი   არს და ...
                    </option>
                    <option value="../text/14.html" >
                        § 14. ხოლო   არიან ესე: რაჟამს ...
                    </option>
                    <option value="../text/15.html" >
                        § 15. ხოლო მრავალთა რაჲ პირთა ც...
                    </option>
                    <option value="../text/16.html" >
                        § 16. ამითვე სახითა     არიან, ...
                    </option>
                    <option value="../text/17.html" >
                        § 17. და   არა   ეწოდების სახელ...
                    </option>
                    <option value="../text/18.html" >
                        § 18. ეგრეთვე    :    ,    ,   ...
                    </option>
                    <option value="../text/19.html" >
                        § 19. და ამათ ათცამეტთა   ერთი ...
                    </option>
                    <option value="../text/20.html" >
                        § 20. ესრეთვე        , ვითარმედ...
                    </option>
                    <option value="../text/21.html" >
                        § 21. და ოდეს   ითარგმანებოდის,...
                    </option>
                    <option value="../text/22.html" >
                        § 22. ხოლო სიტყუაჲ იგი   ესე არ...
                    </option>
                    <option value="../text/23.html" >
                        § 23. ხოლო არიან დამორჩილებითნი...
                    </option>
                    <option value="../text/24.html" >
                        § 24. ესენი ვიდრემე დამორჩილები...
                    </option>
                </select>
                <a href="../text/10.html"
                   class="text-gray-400 hover:text-gray-600"
                   title="შემდეგი პარაგრაფი">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
                <span class="text-gray-300 mx-1">|</span>
                <a href="../text/all.html" class="text-xs text-gray-400 hover:text-gray-600" title="აჩვენე ყველა პარაგრაფი ერთად">ყველა ერთად</a>
            </div>
            
            <!-- Right: Display options -->
            <div class="flex items-center gap-4">
                <label class="flex items-center gap-2 text-xs text-gray-500 cursor-pointer" title="კრიტიკული აპარატის ჩვენება/დამალვა">
                    <input type="checkbox" id="show-apparatus" checked class="rounded border-gray-300 text-gray-800 focus:ring-gray-400">
                    აპარატი
                </label>
                <label class="flex items-center gap-2 text-xs text-gray-500 cursor-pointer" title="ფოლიოს მარკერების ჩვენება">
                    <input type="checkbox" id="show-folios" checked class="rounded border-gray-300 text-gray-800 focus:ring-gray-400">
                    ფოლიო
                </label>
            </div>
        </div>
        
        <!-- Text content -->
        <div class="p-8 md:p-12">
            
            
            <section id="sec-9" class="mb-8" data-urn="urn:cts:georgian:shanidze.arthron.ed2025:9">
                
                <!-- Section header with folio markers -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <span class="text-sm font-medium text-gray-400">§ 9</span>
                        <a href="#sec-9" class="section-anchor text-xs" title="ბმული ამ პარაგრაფზე">#</a>
                    </div>
                </div>
                
                <!-- Section content -->
                <div class="font-serif-geo text-lg leading-loose text-gray-800">
                    <p class="text-justify">
                                ხოლო 
                                <span class="apparatus-inline" data-app-id="app.9.1">
                                    <span class="reading-a">განმრავლებით</span>
                                    <span class="reading-s hidden">განმრავლებითა</span>
                                </span><sup class="apparatus-marker" data-app="app.9.1" title="იხ. აპარატი">57</sup>
                                 რაჲ 
                                <span class="apparatus-inline" data-app-id="app.9.2">
                                    <span class="reading-a">იტყოდის</span>
                                    <span class="reading-s hidden">იტყ̃დიან</span>
                                </span><sup class="apparatus-marker" data-app="app.9.2" title="იხ. აპარატი">58</sup>
                                 
                                <span class="apparatus-inline" data-app-id="app.9.3">
                                    <span class="reading-a">სახელთა</span>
                                    <span class="reading-s hidden">სახელსა</span>
                                </span><sup class="apparatus-marker" data-app="app.9.3" title="იხ. აპარატი">59</sup>
                                 ღმერთთასა, არა ეგრეთ იტყჳან, ვითარცა 
                                <a href="../lexicon/index.html##lex.dual" class="term-link" data-term="#lex.dual" title="იხ. ლექსიკონში">ორობითთა</a>
                                 შინა, ზემო ცხად-ქმნილთა, არამედ ესრეთ, ვითარმედ: 
                                <span class="font-medium">ი თეი</span> <span class="greek text-gray-500">(οἱ θεοί)</span>                                 
                                , ესე იგი არს, ვითარმედ: 
                                <span class="font-medium">ღმერთნი</span>                                 და 
                                <span class="apparatus-inline" data-app-id="app.9.4">
                                    <span class="reading-a">ნათესაობითად</span>
                                    <span class="reading-s hidden">ნათესავობითად</span>
                                </span><sup class="apparatus-marker" data-app="app.9.4" title="იხ. აპარატი">60</sup>
                                 
                                <span class="font-medium">ტონ თეონ</span> <span class="greek text-gray-500">(τῶν θεῶν)</span>                                 
                                , ვითარმედ: 
                                <span class="font-medium">ღმერთთანი</span>                                , რამეთუ ამას ეწოდების 
                                <a href="../lexicon/index.html##lex.gen" class="term-link" data-term="#lex.gen" title="იხ. ლექსიკონში">შობილობითი</a>
                                 და 
                                <span class="apparatus-inline" data-app-id="app.9.5">
                                    <span class="reading-a">ნათესაობითი</span>
                                    <span class="reading-s hidden">om.</span>
                                </span><sup class="apparatus-marker" data-app="app.9.5" title="იხ. აპარატი">61</sup>
                                 
                                <span class="apparatus-inline" data-app-id="app.9.6">
                                    <span class="reading-a">დრეკად</span>
                                    <span class="reading-s hidden">დრეკა</span>
                                </span><sup class="apparatus-marker" data-app="app.9.6" title="იხ. აპარატი">62</sup>
                                 
                                <span class="apparatus-inline" data-app-id="app.9.7">
                                    <span class="reading-a">სახელისად</span>
                                    <span class="reading-s hidden">სახელისა</span>
                                </span><sup class="apparatus-marker" data-app="app.9.7" title="იხ. აპარატი">63</sup>
                                . ხოლო 
                                <a href="../lexicon/index.html##lex.dat" class="term-link" data-term="#lex.dat" title="იხ. ლექსიკონში">მიცემითი</a>
                                : 
                                <span class="font-medium">ტის თეის</span> <span class="greek text-gray-500">(τοῖς θεοῖς)</span>                                 
                                , ვითარმედ: 
                                <span class="font-medium">ღმერთთა</span>                                ; და 
                                <a href="../lexicon/index.html##lex.acc" class="term-link" data-term="#lex.acc" title="იხ. ლექსიკონში">მიზეზობითი</a>
                                : 
                                <span class="font-medium">ტუს თეუს</span> <span class="greek text-gray-500">(τοὺς θεούς)</span>                                 
                                , ვითარმედ: 
                                <span class="apparatus-inline" data-app-id="app.9.8">
                                    <span class="reading-a">ღმერთთა</span>
                                    <span class="reading-s hidden">om.</span>
                                </span><sup class="apparatus-marker" data-app="app.9.8" title="იხ. აპარატი">64</sup>
                                .
                    </p>
                </div>
                
                <!-- Per-section apparatus (for single section view) -->
                <div class="section-apparatus mt-8 pt-6 border-t border-gray-100" id="apparatus-9">
                    <h3 class="text-xs font-medium text-gray-400 uppercase tracking-wide mb-3">კრიტიკული აპარატი</h3>
                    <div class="text-sm text-gray-600 space-y-1.5">
                        <p id="app-app.9.1" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">57</sup>
                            <span class="font-medium">განმრავლებით</span><span class="text-gray-400">]</span>
<span>განმრავლებითა</span>                                 <span class="text-gray-400">S</span>                        </p>
                        <p id="app-app.9.2" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">58</sup>
                            <span class="font-medium">იტყოდის</span><span class="text-gray-400">]</span>
<span class="italic text-gray-500">სრულად სწერია</span>                                 <span class="text-gray-400">A</span><span class="text-gray-300">,</span> <span>იტყ̃დიან</span>                                 <span class="text-gray-400">S</span>                        </p>
                        <p id="app-app.9.3" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">59</sup>
                            <span class="font-medium">სახელთა</span><span class="text-gray-400">]</span>
<span>სახელსა</span>                                 <span class="text-gray-400">S</span>                        </p>
                        <p id="app-app.9.4" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">60</sup>
                            <span class="font-medium">ნათესაობითად</span><span class="text-gray-400">]</span>
<span>ნათესავობითად</span>                                 <span class="text-gray-400">S</span>                        </p>
                        <p id="app-app.9.5" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">61</sup>
                            <span class="font-medium">ნათესაობითი</span><span class="text-gray-400">]</span>
<span class="italic text-gray-500">om.</span>                                 <span class="text-gray-400">S</span>                        </p>
                        <p id="app-app.9.6" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">62</sup>
                            <span class="font-medium">დრეკად</span><span class="text-gray-400">]</span>
<span>დრეკა</span>                                 <span class="text-gray-400">S</span>                        </p>
                        <p id="app-app.9.7" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">63</sup>
                            <span class="font-medium">სახელისად</span><span class="text-gray-400">]</span>
<span>სახელისა</span>                                 <span class="text-gray-400">S</span>                        </p>
                        <p id="app-app.9.8" class="apparatus-entry pl-4 border-l-2 border-gray-100">
                            <sup class="text-amber-600 mr-1">64</sup>
                            <span class="font-medium">ღმერთთა</span><span class="text-gray-400">]</span>
<span class="italic text-gray-500">om.</span>                                 <span class="text-gray-400">S</span>                        </p>
                    </div>
                </div>
            </section>
            
            <!-- Combined apparatus (for all sections view) -->
            
        </div>
        
        <!-- Lexicon Popup (positioned by JS) -->
        <div id="lexicon-popup" class="lexicon-popup">
            <div class="p-3">
                <div class="flex items-start justify-between gap-2 mb-1.5">
                    <h4 id="popup-lemma" class="font-medium text-gray-900"></h4>
                    <span id="popup-pos" class="text-xs px-1.5 py-0.5 bg-gray-100 rounded text-gray-500"></span>
                </div>
                <p id="popup-greek" class="text-sm text-gray-500 greek mb-1.5"></p>
                <p id="popup-def" class="text-sm text-gray-600 leading-relaxed"></p>
            </div>
            <div class="px-3 py-2 bg-gray-50 border-t border-gray-100 rounded-b-lg">
                <a id="popup-link" href="#" class="text-xs text-indigo-600 hover:text-indigo-800 flex items-center gap-1">
                    სრულად ლექსიკონში
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                    </svg>
                </a>
            </div>
        </div>
        
    </article>
    
    <!-- Pagination (single section view only) -->
    <div class="flex items-center justify-between mt-8 text-sm">
        <div class="flex items-center gap-4">
            <span class="text-gray-400">9 / 24</span>
            <a href="../text/all.html#sec-9" class="text-xs text-gray-400 hover:text-gray-600">კონტექსტში ნახვა</a>
        </div>
        <div class="flex gap-2">
            <a href="../text/8.html" 
               class="px-4 py-2 border border-gray-200 rounded text-gray-600 hover:bg-gray-50">
                <span class="hidden sm:inline">წინა</span>
                <span class="sm:hidden">←</span>
            </a>
            <a href="../text/10.html"
               class="px-4 py-2 border border-gray-200 rounded text-gray-600 hover:bg-gray-50">
                <span class="hidden sm:inline">შემდეგი</span>
                <span class="sm:hidden">→</span>
            </a>
        </div>
    </div>
    
    <!-- Jump to top (all sections view) -->
    
</main>

    <!-- Footer -->
    <footer class="border-t border-gray-200 py-6 px-4 mt-12">
        <div class="max-w-5xl mx-auto flex items-center justify-between text-xs text-gray-400">
            <span>2025, ლინგვისტურ კვლევათა ინსტიტუტი</span>
            <div class="flex items-center gap-4">
                <a href="https://github.com" class="hover:text-gray-600">საიუბილეო ციფრული გამოცემა</a>
            </div>
        </div>
    </footer>
    
<script>
// Lexicon data embedded from build
const lexiconData = {"lex.agebuli": {"lemma": "აგებული", "greek": null, "pos": null, "def": "შექმნილი, მატერიალური, არსებული", "def_en": ""}, "lex.adviloba": {"lemma": "ადვილობა", "greek": null, "pos": null, "def": "მარტივი, სახელობითი ბრუნვა", "def_en": ""}, "lex.antipa": {"lemma": "ანტიპა", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.arthron": {"lemma": "ართრონი", "greek": null, "pos": "n.", "def": "განსაზღვრებითი ნაწევარი", "def_en": "definite article"}, "lex.arthroniani": {"lemma": "ართრონიანი", "greek": null, "pos": null, "def": "არტიკლიანი", "def_en": ""}, "lex.arianozi": {"lemma": "არიანოზ-ი", "greek": null, "pos": null, "def": "არიოსის მიმდევარი, მწვალებელი", "def_en": ""}, "lex.aghgeba": {"lemma": "აღგება", "greek": null, "pos": null, "def": "შექმნა", "def_en": ""}, "lex.aghvseba": {"lemma": "აღვსება", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.aghmgebeli": {"lemma": "აღმგებელი", "greek": null, "pos": null, "def": "შემქმნელი", "def_en": ""}, "lex.aghmoceneba": {"lemma": "აღმოცენება", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.aghmochra": {"lemma": "აღმოჭრა", "greek": null, "pos": null, "def": "მოსპობა", "def_en": ""}, "lex.aghmojdoma": {"lemma": "აღმოჯდომა", "greek": null, "pos": null, "def": "ამოსვლა", "def_en": ""}, "lex.aghrackhuli": {"lemma": "აღრაცხული", "greek": null, "pos": null, "def": "ჩათვლილი", "def_en": ""}, "lex.aghqvaneba": {"lemma": "აღყვანება", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.borgneuli": {"lemma": "ბორგნეული", "greek": null, "pos": null, "def": "მებრძოლი", "def_en": ""}, "lex.brgunva": {"lemma": "ბრგუნვა", "greek": null, "pos": null, "def": "ენამძიმედ, ენადაბმულად მეტყველება", "def_en": ""}, "lex.brgunvili": {"lemma": "ბრგუნვილი", "greek": null, "pos": null, "def": "ცუდად, მძიმედ გამოთქმული", "def_en": ""}, "lex.buneba": {"lemma": "ბუნება", "greek": null, "pos": null, "def": "მატერიალური, ფიზიკური ნაწილი (სხეულისა)", "def_en": ""}, "lex.gamometqueli": {"lemma": "გამომეტყუელი", "greek": null, "pos": null, "def": "მთხრობი, ავტორი", "def_en": ""}, "lex.gamomtkhovneli": {"lemma": "გამომთხოვნელი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.gamoparva": {"lemma": "გამოპარვა", "greek": null, "pos": null, "def": "უჩუმრად, შეუმჩნევლად შემოსვლა", "def_en": ""}, "lex.gamosachinebeli": {"lemma": "გამოსაჩინებელი", "greek": null, "pos": null, "def": "მაგალითი", "def_en": ""}, "lex.ganmvedreba": {"lemma": "განმვედრება", "greek": null, "pos": null, "def": "გაძლიერება", "def_en": ""}, "lex.ganmtkumeli": {"lemma": "განმთქუმელი", "greek": null, "pos": null, "def": "განმცხადებელი, ამბის გამავრცელებელი", "def_en": ""}, "lex.ganmkacreba": {"lemma": "განმკაცრება", "greek": null, "pos": null, "def": "დაწვრილებით გამოძიება, ჩაძიება", "def_en": ""}, "lex.plural": {"lemma": "განმრავლებითი", "greek": null, "pos": null, "def": "მრავლობითი რიცხვი", "def_en": ""}, "lex.ganmcdeloba": {"lemma": "განმცდელობა", "greek": null, "pos": null, "def": "ცდა", "def_en": ""}, "lex.ganmkhilveli": {"lemma": "განმხილველი", "greek": null, "pos": null, "def": "განხილვა, მოფიქრება (მთხრელები?)", "def_en": ""}, "lex.gansazghvreba": {"lemma": "განსაზღვრება", "greek": null, "pos": null, "def": "განსაზღვრა, დადგენა", "def_en": ""}, "lex.gansazghvrebuli": {"lemma": "განსაზღვრებული", "greek": null, "pos": null, "def": "დადგენილი", "def_en": ""}, "lex.ganqofileba": {"lemma": "განყოფილება", "greek": null, "pos": null, "def": "განსხვავებულობა, სხვადასხვაობა", "def_en": ""}, "lex.ganchineba": {"lemma": "განჩინებაი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.gancdili": {"lemma": "განცდილი", "greek": null, "pos": null, "def": "ნახული", "def_en": ""}, "lex.ganckhadebuli": {"lemma": "განცხადებული", "greek": null, "pos": null, "def": "აშკარა, თვალით სახილველი", "def_en": ""}, "lex.gardadgoma": {"lemma": "გარდადგომა", "greek": null, "pos": null, "def": "გადაადგილება, ადგილის შეცვლა", "def_en": ""}, "lex.gonieri": {"lemma": "გონიერი", "greek": null, "pos": null, "def": "გონებით წარმოდგენილი, არამატერიალური", "def_en": ""}, "lex.grdznobadi": {"lemma": "გრძნობადი", "greek": null, "pos": null, "def": "შეგრძნებადი, მატერიალური", "def_en": ""}, "lex.gulvebadi": {"lemma": "გულვებადი", "greek": null, "pos": null, "def": "მომავალი, მყოფადი", "def_en": ""}, "lex.dadgineba": {"lemma": "დადგინება", "greek": null, "pos": null, "def": "დაყენება, გაჩერება", "def_en": ""}, "lex.daknineba": {"lemma": "დაკნინებაი", "greek": null, "pos": null, "def": "დამცირება", "def_en": ""}, "lex.dambechdveli": {"lemma": "დამბეჭდველი", "greek": null, "pos": null, "def": "განმამტკიცებელი, დამმოწმებელი", "def_en": ""}, "lex.damtkhuevit": {"lemma": "დამთხუევით", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.dampqrobeli": {"lemma": "დამპყრობელი", "greek": null, "pos": null, "def": "ძლევამოსილი, გაბატონებული", "def_en": ""}, "lex.dasabami": {"lemma": "დასაბამი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.dasatevneli": {"lemma": "დასატევნელი", "greek": null, "pos": null, "def": "შესაძლებელი", "def_en": ""}, "lex.datevna": {"lemma": "დატევნა", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.daqenebuli": {"lemma": "დაყენებული", "greek": null, "pos": null, "def": "აკრძალული, მიუღებელი", "def_en": ""}, "lex.daqofili": {"lemma": "დაყოფილი", "greek": null, "pos": null, "def": "დახშული, დახურული", "def_en": ""}, "lex.dajsna": {"lemma": "დაჯსნა", "greek": null, "pos": null, "def": "მოსპობა", "def_en": ""}, "lex.fem": {"lemma": "დედალი", "greek": null, "pos": null, "def": "მდედრობითი სქესი", "def_en": ""}, "lex.dreka": {"lemma": "დრეკა", "greek": null, "pos": null, "def": "ბრუნება", "def_en": ""}, "lex.sing": {"lemma": "ერთობითი", "greek": null, "pos": null, "def": "მხოლობითი რიცხვი", "def_en": ""}, "lex.eksoria": {"lemma": "ექსორია", "greek": null, "pos": null, "def": "გაძევება", "def_en": ""}, "lex.vidreme": {"lemma": "ვიდრემე", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.vrcelmetqueleba": {"lemma": "ვრცელ-მეტყუელებაი", "greek": null, "pos": null, "def": "ვრცლად, გრძლად ლაპარაკი", "def_en": ""}, "lex.tanamoqmedi": {"lemma": "თანა-მოქმედი", "greek": null, "pos": null, "def": "ერთად მოქმედი", "def_en": ""}, "lex.tanaqceva": {"lemma": "თანა-ქცევა", "greek": null, "pos": null, "def": "ერთად ყოფნა", "def_en": ""}, "lex.iataki": {"lemma": "იატაკი", "greek": null, "pos": null, "def": "საფუძველი, ძირი", "def_en": ""}, "lex.iefoba": {"lemma": "იეფობაი", "greek": null, "pos": null, "def": "სიუხვე, მრავლად ყოფნა", "def_en": ""}, "lex.kacobrivi": {"lemma": "კაცობრივი", "greek": null, "pos": null, "def": "ადამიანური, ადამიანისათzს დამახასიათებელი", "def_en": ""}, "lex.leqseulad": {"lemma": "ლექსეულად", "greek": null, "pos": null, "def": "სიტყვა-სიტყვით", "def_en": ""}, "lex.leqsi": {"lemma": "ლექსი", "greek": null, "pos": null, "def": "სიტყვა, ტერმინი", "def_en": ""}, "lex.masc": {"lemma": "მამალი", "greek": null, "pos": null, "def": "მამრობითი სქესი", "def_en": ""}, "lex.martivi": {"lemma": "მარტივი", "greek": null, "pos": null, "def": "უბრალო, განუსწავლელი", "def_en": ""}, "lex.mgulebeli": {"lemma": "მგულებელი", "greek": null, "pos": null, "def": "მსურველი, განზრახველი", "def_en": ""}, "lex.mezobloba": {"lemma": "მეზობლობა", "greek": null, "pos": null, "def": "ახლოს ცხოვრება, მეზობლად ყოფნა", "def_en": ""}, "lex.mecnieri": {"lemma": "მეცნიერი", "greek": null, "pos": null, "def": "მცოდნე", "def_en": ""}, "lex.acc": {"lemma": "მიზეზობითი", "greek": null, "pos": null, "def": "ბრალდებითი ბრუნვა", "def_en": ""}, "lex.mitualva": {"lemma": "მითუალვა", "greek": null, "pos": null, "def": "მიღება", "def_en": ""}, "lex.mifarulqmnili": {"lemma": "მიფარულ-ქმნილი", "greek": null, "pos": null, "def": "დაფარული", "def_en": ""}, "lex.miquma": {"lemma": "მიქუმა", "greek": null, "pos": null, "def": "აყვანა", "def_en": ""}, "lex.dat": {"lemma": "მიცემითი", "greek": null, "pos": null, "def": "მიცემითი ბრუნვა", "def_en": ""}, "lex.mknoba": {"lemma": "მკნობა", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.mmcqseli": {"lemma": "მმწყსელი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.mnebebeloba": {"lemma": "მნებებელობა", "greek": null, "pos": null, "def": "მოსურვება", "def_en": ""}, "lex.moakhleba": {"lemma": "მოახლება", "greek": null, "pos": null, "def": "მოახლოვება", "def_en": ""}, "lex.mogoneba": {"lemma": "მოგონებაი", "greek": null, "pos": null, "def": "გააზრება, გაგება", "def_en": ""}, "lex.molodebadi": {"lemma": "მოლოდებადი", "greek": null, "pos": null, "def": "მომავალი, მყოფადი", "def_en": ""}, "lex.momvachrebeli": {"lemma": "მომვაჭრებელი", "greek": null, "pos": null, "def": "შემსრულებელი, საქმის აღმსრულებელი", "def_en": ""}, "lex.momchirneoba": {"lemma": "მომჭირნეობაი", "greek": null, "pos": null, "def": "მოთმინება, ჭირთა თმენა", "def_en": ""}, "lex.mosajuloba": {"lemma": "მოსაჯულობაი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.moqaduli": {"lemma": "მოქადული", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.moqalaqoba": {"lemma": "მოქალაქობა", "greek": null, "pos": null, "def": "ცხოვრება, მოქმედება", "def_en": ""}, "lex.mocapeqofa": {"lemma": "მოწაფე-ყოფაი", "greek": null, "pos": null, "def": "დამოწაფება, დამორჩილება", "def_en": ""}, "lex.mravalghmrteeba": {"lemma": "მრავალღმრთეებაი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.mqcevaroba": {"lemma": "მქცევარობაი", "greek": null, "pos": null, "def": "სიარული, მიმოსვლა", "def_en": ""}, "lex.mqceoba": {"lemma": "მქცეობაი", "greek": null, "pos": null, "def": "თვისება, საქციელი", "def_en": ""}, "lex.mdzlavrebuli": {"lemma": "მძლავრებული", "greek": null, "pos": null, "def": "დაძლეული, დაჯაბნებული", "def_en": ""}, "lex.nametavi": {"lemma": "ნამეტავი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.dual": {"lemma": "ორობითი", "greek": null, "pos": null, "def": "ორობითი რიცხვი", "def_en": ""}, "lex.orghano": {"lemma": "ორღანო", "greek": null, "pos": null, "def": "იარაღი, ორგანო", "def_en": ""}, "lex.ridoba": {"lemma": "რიდობაი", "greek": null, "pos": null, "def": "მოკრძალება, კრძალვა", "def_en": ""}, "lex.ritori": {"lemma": "რიტორი", "greek": null, "pos": null, "def": "ორატორი, მჭევრმეტყველი", "def_en": ""}, "lex.satanasdebo": {"lemma": "სათანამდებოი", "greek": null, "pos": null, "def": "საჭირო, დასაშვები", "def_en": ""}, "lex.sakmareba": {"lemma": "საკმარებაი", "greek": null, "pos": null, "def": "საჭიროება", "def_en": ""}, "lex.trias": {"lemma": "სამება", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.samscuali": {"lemma": "სამსჭუალი", "greek": null, "pos": null, "def": "ლურსმანი", "def_en": ""}, "lex.sanadiro": {"lemma": "სანადიროი", "greek": null, "pos": null, "def": "მისაგნებელი, დასაჭერი", "def_en": ""}, "lex.saolavi": {"lemma": "საოლავი", "greek": null, "pos": null, "def": "აშია; კიდე", "def_en": ""}, "lex.sartuli": {"lemma": "სართული", "greek": null, "pos": null, "def": "სახურავი; ზეცა (მეტაფორულად)", "def_en": ""}, "lex.sasmeneli": {"lemma": "სასმენელი", "greek": null, "pos": null, "def": "ყური", "def_en": ""}, "lex.sasjelisqueshe": {"lemma": "სასჯელის-ქუეშე", "greek": null, "pos": null, "def": "დასასჯელი", "def_en": ""}, "lex.sashuro": {"lemma": "საშუროი", "greek": null, "pos": null, "def": "საჩქარო", "def_en": ""}, "lex.sactomeli": {"lemma": "საცთომელი", "greek": null, "pos": null, "def": "შესაცდენელი", "def_en": ""}, "lex.sacuto": {"lemma": "საწუთოი", "greek": null, "pos": null, "def": "წუთისოფელი", "def_en": ""}, "lex.siadre": {"lemma": "სიადრე", "greek": null, "pos": null, "def": "სიჩქარე", "def_en": ""}, "lex.sircxvleuli": {"lemma": "სირცხვლეული", "greek": null, "pos": null, "def": "შერცხვენილი", "def_en": ""}, "lex.skntema": {"lemma": "სკნთემაი", "greek": null, "pos": null, "def": "თან-შედგმა, შეწყობა", "def_en": ""}, "lex.sruleba": {"lemma": "სრულებაი", "greek": null, "pos": null, "def": "სრულყოფილება, სავსება", "def_en": ""}, "lex.pneuma": {"lemma": "სული", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.sulisambrdzoli": {"lemma": "სულისა მბრძოლი", "greek": null, "pos": null, "def": "მწვალებელი (მაკედონიანელი)", "def_en": ""}, "lex.tanjva": {"lemma": "ტანჯვა", "greek": null, "pos": null, "def": "ბრძოლა", "def_en": ""}, "lex.turtva": {"lemma": "ტურთვა", "greek": null, "pos": null, "def": "აღება, ხელში აყვანა", "def_en": ""}, "lex.uarthrono": {"lemma": "უართრონო", "greek": null, "pos": null, "def": "უარტიკლო; ართრონის გარეშე", "def_en": ""}, "lex.uidzulebeli": {"lemma": "უიძულებელი", "greek": null, "pos": null, "def": "თავისთავადი, არა-ნაძალადევი", "def_en": ""}, "lex.ukunsaqceveli": {"lemma": "უკუნსაქცეველი", "greek": null, "pos": null, "def": "უარსაყოფელი", "def_en": ""}, "lex.umkuetelesi": {"lemma": "უმკუეთელესი", "greek": null, "pos": null, "def": "უფრო მჭრელი", "def_en": ""}, "lex.usamartloeba": {"lemma": "უსამართლოება", "greek": null, "pos": null, "def": "უსამართლოების ჩადენა", "def_en": ""}, "lex.uqorcinebeli": {"lemma": "უქორწინებელი", "greek": null, "pos": null, "def": "გაუთხოვარი", "def_en": ""}, "lex.uquenaesi": {"lemma": "უქუენაესი", "greek": null, "pos": null, "def": "უმდაბლესი", "def_en": ""}, "lex.ughelvo": {"lemma": "უღელვო", "greek": null, "pos": null, "def": "დაწყნარებული, დამშვიდებული", "def_en": ""}, "lex.ughono": {"lemma": "უღონო", "greek": null, "pos": null, "def": "უძლური", "def_en": ""}, "lex.ughonoeba": {"lemma": "უღონოება", "greek": null, "pos": null, "def": "საშუალების, ღონის ვერ პოვნა", "def_en": ""}, "lex.frtoanqmna": {"lemma": "ფრთოან-ქმნაი", "greek": null, "pos": null, "def": "ფრთების შესხმა", "def_en": ""}, "lex.qandakebuli": {"lemma": "ქანდაკებული", "greek": null, "pos": null, "def": "გამოძერწილი", "def_en": ""}, "lex.quequemo": {"lemma": "ქუე-ქუემოი", "greek": null, "pos": null, "def": "ქვედა ჩასაცმელი?", "def_en": ""}, "lex.theos": {"lemma": "ღმერთი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.ghuacli": {"lemma": "ღუაწლი", "greek": null, "pos": null, "def": "ბრძოლა", "def_en": ""}, "lex.qovlisampqrobeli": {"lemma": "ყოვლისა მპყრობელი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.qovlisampqrobelibri": {"lemma": "ყოვლისამპყრობელებრი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.sharavandedi": {"lemma": "შარავანდედი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.sheachrdilebuli": {"lemma": "შეაჩრდილებული", "greek": null, "pos": null, "def": "ბნელი, გაუგებარი, არანათელი", "def_en": ""}, "lex.shebavteba": {"lemma": "შებავთება", "greek": null, "pos": null, "def": "სიტყვსა ცუდის თქმა", "def_en": ""}, "lex.shemdgomoba": {"lemma": "შემდგომობაი", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.shemomnivtebeli": {"lemma": "შემომნივთებელი", "greek": null, "pos": null, "def": "მატერიალურად გარდამქცეველი", "def_en": ""}, "lex.shemortuma": {"lemma": "შემორთუმა", "greek": null, "pos": null, "def": "დამატება, შემატება", "def_en": ""}, "lex.shemosruli": {"lemma": "შემოსრული", "greek": null, "pos": null, "def": "", "def_en": ""}, "lex.shemrghueva": {"lemma": "შემრღუევა", "greek": null, "pos": null, "def": "გონების არევა, ამღვრევა", "def_en": ""}, "lex.shemchrdilveli": {"lemma": "შემჩრდილველი", "greek": null, "pos": null, "def": "დამაბნელებელი, დამფარველი", "def_en": ""}, "lex.shemcinquleba": {"lemma": "შემწინკულება", "greek": null, "pos": null, "def": "წაბილწვა, დასვრა", "def_en": ""}, "lex.shenacevreba": {"lemma": "შენაწევრება", "greek": null, "pos": null, "def": "შეერთება", "def_en": ""}, "lex.shesadginebeli": {"lemma": "შესადგინებელი", "greek": null, "pos": null, "def": "შემდგომად მოსასვლელი, მომდევნო", "def_en": ""}, "lex.shishueli": {"lemma": "შიშუელი", "greek": null, "pos": null, "def": "დაუფარავი, აშკარა, უშუალო", "def_en": ""}, "lex.gen": {"lemma": "შობილობითი", "greek": null, "pos": null, "def": "ნათესაობითი ბრუნვა", "def_en": ""}, "lex.neut": {"lemma": "შუაჲ", "greek": null, "pos": null, "def": "საშუალო სქესი", "def_en": ""}, "lex.cmeli": {"lemma": "ცმელი", "greek": null, "pos": null, "def": "ცხიმი, ქონი", "def_en": ""}, "lex.dzvnad": {"lemma": "ძვნად", "greek": null, "pos": null, "def": "საწინააღმდეგოდ", "def_en": ""}, "lex.dzlit": {"lemma": "ძლით", "greek": null, "pos": null, "def": "მიზეზით, საშუალებით", "def_en": ""}, "lex.carmodgineba": {"lemma": "წარმოდგინება", "greek": null, "pos": null, "def": "ჩვენება", "def_en": ""}, "lex.caroteba": {"lemma": "წაროტება", "greek": null, "pos": null, "def": "გაგდება, გაძევება", "def_en": ""}, "lex.cdeva": {"lemma": "წდევა", "greek": null, "pos": null, "def": "დასხმა სითხისა", "def_en": ""}, "lex.cesi": {"lemma": "წესი", "greek": null, "pos": null, "def": "დაწყობილება, განლაგება", "def_en": ""}, "lex.ciagh": {"lemma": "წიაღ", "greek": null, "pos": null, "def": "კალთა, უბე", "def_en": ""}, "lex.voc": {"lemma": "წოდებითი", "greek": null, "pos": null, "def": "წოდებითი ბრუნვა", "def_en": ""}, "lex.khelovanmetqueleba": {"lemma": "ჴელოვან-მეტყუელება", "greek": null, "pos": null, "def": "არასწორის თქმა", "def_en": ""}, "lex.khumeuli": {"lemma": "ჴუმეული", "greek": null, "pos": null, "def": "დაკლებული", "def_en": ""}};
const lexiconBaseUrl = '../lexicon/index.html';

// Witness data
const witnessData = {
    A: {
        sigil: 'A',
        settlement: 'ათონი',
        repository: 'ივერიის (ივერთა) მონასტერი',
        locus: 'ff. 32r–36v'
    },
    S: {
        sigil: 'S',
        settlement: '',
        repository: 'ხელნაწერთა ეროვნული ცენტრი',
        locus: 'ff. 106r–108v'
    }
};

// Lexicon popup functionality
const popup = document.getElementById('lexicon-popup');
const article = document.getElementById('text-article');
const popupLemma = document.getElementById('popup-lemma');
const popupGreek = document.getElementById('popup-greek');
const popupPos = document.getElementById('popup-pos');
const popupDef = document.getElementById('popup-def');
const popupLink = document.getElementById('popup-link');

let popupTimeout;
let currentTermLink = null;

function showPopup(termLink) {
    const termId = termLink.dataset.term.replace('lex.', '');
    const entry = lexiconData[termId];
    
    if (!entry) {
        return;
    }
    
    currentTermLink = termLink;
    
    // Populate popup
    popupLemma.textContent = entry.lemma;
    popupGreek.textContent = entry.greek ? `(${entry.greek})` : '';
    popupGreek.style.display = entry.greek ? '' : 'none';
    popupPos.textContent = entry.pos || '';
    popupPos.style.display = entry.pos ? '' : 'none';
    popupDef.textContent = entry.def || 'განმარტება არ არის';
    popupLink.href = `${lexiconBaseUrl}#${termId}`;
    
    // Get positions
    const termRect = termLink.getBoundingClientRect();
    const articleRect = article.getBoundingClientRect();
    const popupWidth = 260;
    const popupHeight = popup.offsetHeight || 140;
    
    // Check if we have room to the right (large screen margin note style)
    const spaceRight = window.innerWidth - articleRect.right;
    const isLargeScreen = window.innerWidth >= 1280;
    
    if (isLargeScreen && spaceRight >= popupWidth + 40) {
        // Position as margin note to the right of article
        popup.style.position = 'absolute';
        popup.style.left = (articleRect.width + 20) + 'px';
        popup.style.top = (termRect.top - articleRect.top + article.scrollTop - 4) + 'px';
    } else {
        // Position below the term (small screen fallback)
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // Check if there's room below
        const spaceBelow = window.innerHeight - termRect.bottom;
        
        popup.style.position = 'fixed';
        
        if (spaceBelow >= popupHeight + 20) {
            popup.style.top = (termRect.bottom + 8) + 'px';
        } else {
            popup.style.top = (termRect.top - popupHeight - 8) + 'px';
        }
        
        // Horizontal centering on term
        let left = termRect.left + (termRect.width / 2) - (popupWidth / 2);
        if (left < 16) left = 16;
        if (left + popupWidth > window.innerWidth - 16) {
            left = window.innerWidth - popupWidth - 16;
        }
        popup.style.left = left + 'px';
    }
    
    popup.classList.add('visible');
}

function hidePopup() {
    popup.classList.remove('visible');
    currentTermLink = null;
}

// Event listeners for term links
document.querySelectorAll('.term-link').forEach(link => {
    link.addEventListener('mouseenter', function(e) {
        clearTimeout(popupTimeout);
        popupTimeout = setTimeout(() => showPopup(this), 200);
    });
    
    link.addEventListener('mouseleave', function(e) {
        clearTimeout(popupTimeout);
        popupTimeout = setTimeout(hidePopup, 300);
    });
    
    link.addEventListener('click', function(e) {
        const termId = this.dataset.term.replace('lex.', '');
        if (lexiconData[termId]) {
            e.preventDefault();
            if (popup.classList.contains('visible') && currentTermLink === this) {
                hidePopup();
            } else {
                showPopup(this);
            }
        }
    });
});

// Keep popup visible when hovering over it
popup.addEventListener('mouseenter', function() {
    clearTimeout(popupTimeout);
});

popup.addEventListener('mouseleave', function() {
    popupTimeout = setTimeout(hidePopup, 200);
});

// Close popup on escape or click outside
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') hidePopup();
});

document.addEventListener('click', function(e) {
    if (!e.target.closest('.term-link') && !e.target.closest('.lexicon-popup')) {
        hidePopup();
    }
});

// Hide popup on scroll (for fixed positioning mode)
let scrollTimeout;
window.addEventListener('scroll', function() {
    if (popup.style.position === 'fixed' && popup.classList.contains('visible')) {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(hidePopup, 100);
    }
});

// Update witness info bar
function updateWitnessBar(witness) {
    const data = witnessData[witness];
    document.getElementById('witness-sigil').textContent = data.sigil;
    document.getElementById('witness-settlement').textContent = data.settlement;
    document.getElementById('witness-repository').textContent = data.repository;
    document.getElementById('witness-locus').textContent = data.locus;
}

// Witness toggle
document.querySelectorAll('.witness-toggle').forEach(btn => {
    btn.addEventListener('click', function() {
        const witness = this.dataset.witness;
        document.querySelectorAll('.witness-toggle').forEach(b => {
            b.classList.remove('active');
            b.classList.add('bg-white', 'text-gray-600');
        });
        this.classList.add('active');
        this.classList.remove('bg-white', 'text-gray-600');
        
        // Update text readings
        document.querySelectorAll('.apparatus-inline').forEach(span => {
            const readingA = span.querySelector('.reading-a');
            const readingS = span.querySelector('.reading-s');
            if (witness === 'A') {
                readingA.classList.remove('hidden');
                readingS.classList.add('hidden');
            } else {
                readingA.classList.add('hidden');
                readingS.classList.remove('hidden');
            }
        });
        
        // Update witness bar
        updateWitnessBar(witness);
        
        // Store preference
        localStorage.setItem('preferred-witness', witness);
    });
});

// Restore witness preference
const savedWitness = localStorage.getItem('preferred-witness');
if (savedWitness) {
    const btn = document.querySelector(`.witness-toggle[data-witness="${savedWitness}"]`);
    if (btn) btn.click();
}

// Toggle apparatus visibility
const apparatusCheckbox = document.getElementById('show-apparatus');
if (apparatusCheckbox) {
    apparatusCheckbox.addEventListener('change', function() {
        const panels = document.querySelectorAll('.section-apparatus, .combined-apparatus');
        const markers = document.querySelectorAll('.apparatus-marker');
        panels.forEach(p => p.style.display = this.checked ? '' : 'none');
        markers.forEach(m => m.style.display = this.checked ? '' : 'none');
    });
}

// Toggle folio markers visibility
const folioCheckbox = document.getElementById('show-folios');
if (folioCheckbox) {
    folioCheckbox.addEventListener('change', function() {
        const markers = document.querySelectorAll('.folio-marker, .folio-markers, .inline-folio');
        markers.forEach(m => m.style.display = this.checked ? '' : 'none');
    });
}

// Highlight apparatus on marker click/hover
document.querySelectorAll('.apparatus-marker').forEach(marker => {
    marker.addEventListener('click', function(e) {
        e.preventDefault();
        const appId = this.dataset.app;
        const entry = document.getElementById('app-' + appId);
        if (entry) {
            entry.scrollIntoView({ behavior: 'smooth', block: 'center' });
            entry.classList.add('highlighted');
            setTimeout(() => entry.classList.remove('highlighted'), 2000);
        }
    });
    
    marker.addEventListener('mouseenter', function() {
        const appId = this.dataset.app;
        const entry = document.getElementById('app-' + appId);
        if (entry) entry.classList.add('highlighted');
    });
    
    marker.addEventListener('mouseleave', function() {
        const appId = this.dataset.app;
        const entry = document.getElementById('app-' + appId);
        if (entry) entry.classList.remove('highlighted');
    });
});

// Scroll to section if hash present
if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
        setTimeout(() => {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    }
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
    
    const prevLink = document.querySelector('a[title="წინა პარაგრაფი"]:not(.cursor-not-allowed)');
    const nextLink = document.querySelector('a[title="შემდეგი პარაგრაფი"]:not(.cursor-not-allowed)');
    
    if (e.key === 'ArrowLeft' && prevLink) {
        window.location.href = prevLink.href;
    } else if (e.key === 'ArrowRight' && nextLink) {
        window.location.href = nextLink.href;
    }
});
</script>
</body>
</html>